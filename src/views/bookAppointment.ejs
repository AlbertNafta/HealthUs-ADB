<%- include("partials/header"); %>
<style>
    .card {
        display: none;
    }

    .card.active {
        display: block;
    }
</style>
<div style="position: absolute;left:34px;top:57px">
    <img src="../public/image/Frame79.png" width="600px">
</div>
<div class="container-making-form align-items-center min-vh-100" >
    <div class="row g-0 justify-content-center">
        <div class="col-lg-4 offset-lg-1 mx-0 px-0"style="position: absolute;right: 160px;">
            <div id="title-container">
                <img class="logo-image" src="">
                <h2 style="text-align:  center;">ĐẶT LỊCH HẸN</h2>
                <h2 style="text-align:  center;">MÃ BỆNH NHÂN: <%= username %></h2>
                <form data-multi-step action="/bookingAppointment/bookDentist" method="POST">
                    <div class="card"style="padding: 10px;" data-step>
                        <div class="form-group">
                            <label for="Clinic">Hãy chọn nơi khám:</label><br><br>
                            <% clinics.forEach((clinic) => { %>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="clinic" id="clinic-<%= clinic.CLINIC_ID %>" value="<%= clinic.CLINIC_ID %>">
                                    <label class="form-check-label" for="clinic-<%= clinic.CLINIC_ID %>"><%= clinic.CLINIC_ADDRESS %></label><br>
                                </div>
                            <% }) %>
                        </div>
                        <br>
                        <button type="button" class="btn btn-primary" data-next>Next</button>
                    </div>
                    
                    <div class="card" data-step style="padding: 10px;">
                        <label for="Schedule">Schedule</label><br>
                            <input type="date" class="form-control" name="appointment_date" id="appointment_date"><br>
                        <input type="radio" name="shift" id="shift-1" value="1">
                        <label for="shift-1">Ca 1: 7h - 8h</label><br>
                        <input type="radio" name="shift" id="shift-2" value="2">
                        <label for="shift-2">Ca 2: 8h - 9h</label><br>
                        <input type="radio" name="shift" id="shift-3" value="3">
                        <label for="shift-3">Ca 3: 9h - 10h</label><br>
                        <input type="radio" name="shift" id="shift-4" value="4">
                        <label for="shift-4">Ca 4: 10h - 11h</label><br>
                        <input type="radio" name="shift" id="shift-5" value="5">
                        <label for="shift-5">Ca 5: 11h - 12h</label><br>
                        <input type="radio" name="shift" id="shift-6" value="6">
                        <label for="shift-6">Ca 6: 13h - 14h</label><br>
                        <input type="radio" name="shift" id="shift-7" value="7">
                        <label for="shift-7">Ca 7: 14h - 15h</label><br>
                        <input type="radio" name="shift" id="shift-1" value="8">
                        <label for="shift-8">Ca 8: 15h - 16h</label><br>
                        <input type="radio" name="shift" id="shift-9" value="9">
                        <label for="shift-9">Ca 9: 16h - 17h</label><br><br>
                        <button type="button" class="btn btn-secondary" data-previous>Previous</button>
                        <button type="button" class="btn btn-primary" data-next>Next</button>
                    </div>
                    <div class="card" data-step style="padding: 10px;">
                        <label for="Treatment">Treatment</label><br><br>
                        <input type="text" class="form-control" name="treatment" id="treatment" placeholder="Nhập loại điều trị bạn cần"><br><br>
                        
                        <button type="button" class="btn btn-secondary" data-previous>Previous</button>
                        <button type="submit" class="btn btn-primary">Chọn nha sĩ</button>
                    </div>
                    
                </form>
            </div>
        </div>
    </div>
</div>
<script>
   const multiStepForm = document.querySelector("[data-multi-step]");
const formSteps = [...multiStepForm.querySelectorAll("[data-step]")];
let currentStep = formSteps.findIndex(step => step.classList.contains("active"));

if (currentStep < 0) {
    currentStep = 0;
    showCurrentStep();
}

multiStepForm.addEventListener("click", e => {
    if (e.target.matches("[data-next]")) {
        // Check if the current step is the Clinic selection step and if a clinic is selected
        if (currentStep === 0 && !isClinicSelected()) {
            alert("Please select a clinic before proceeding.");
            return;
        }

        // Check if the current step is the Schedule selection step and if both date and shift are selected
        if (currentStep === 1 && !isScheduleSelected()) {
            alert("Please select a date and shift before proceeding.");
            return;
        }

        // Check if the current step is the Treatment input step and if the treatment input is not empty
        if (currentStep === 2 && !isTreatmentInputValid()) {
            alert("Please enter the type of treatment before proceeding.");
            return;
        }

        currentStep += 1;
    } else if (e.target.matches("[data-previous]")) {
        currentStep -= 1;
    }

    showCurrentStep();
});

function showCurrentStep() {
    formSteps.forEach((step, index) => {
        step.classList.toggle("active", index === currentStep);
    });
}

function isClinicSelected() {
    const selectedClinic = document.querySelector("input[name='clinic']:checked");
    return selectedClinic !== null;
}

function isScheduleSelected() {
    const appointmentDate = document.getElementById("appointment_date").value;
    const selectedShift = document.querySelector("input[name='shift']:checked");
    return appointmentDate !== "" && selectedShift !== null;
}

function isTreatmentInputValid() {
    const treatmentInput = document.getElementById("treatment").value;
    return treatmentInput.trim() !== "";
}

</script>

